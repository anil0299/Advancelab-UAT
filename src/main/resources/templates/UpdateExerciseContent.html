<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CyberGyan</title>
<link rel="stylesheet" href="" th:href="@{/css/UpdateExerciseContent.css}" />
<link th:href="@{/css/bootstrap.css}" rel="stylesheet">

<link rel="stylesheet" th:href="@{/fontawesome/css/all.min.css}">
<link rel="stylesheet" th:href="@{/css/quill.snow.css}">
<link rel="stylesheet" th:href="@{/css/select2.min.css}">
<style>
.select2 {
width:100%!important;
}
.select2-container--default .select2-selection--single {
    height: calc(2.5rem + 2px); 
    border: 1px solid #ced4da; 
    border-radius: 0.5rem; 
    padding: 0.375rem 0.75rem;
    box-shadow: none;
    background-color: #fff;
    font-size: 1rem;
}
.select2-container--default .select2-search--dropdown .select2-search__field {
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    padding: 0.375rem 0.75rem;
    background-color: #fff;
    font-size: 1rem;
    box-shadow: none;
}

.select2-container--default .select2-search--dropdown .select2-search__field:focus {
    border-color: #ced4da;
    outline: none;
}
</style>
</head>
<body style="background-color: rgb(158, 191, 251);">
	<div class=navcontainer>
		<div class="img-fluid">
			<img style="width: 90px; margin-left: 30px;" src=""
				th:src="@{/images/cdac-wo-bg.png}" alt="">
			<form th:action="@{/logout}" method="post"
				style="float: right; margin-top: 25px; margin-right: 10px">
				<a th:href="@{/welcome}" class="btn btn-primary mb-2"
					style="margin-top: 10px;">Site Home</a> <input type="submit"
					class="btn btn-primary" value="Logout" />
			</form>
		</div>
	</div>
	<div class="lab-desc">
		<a href="AdminHome" style="color: white; text-decoration: none;">Home</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a class="nav-link dropdown-toggle text-white " href="#"
			id="navbarDropdown" role="button" data-bs-toggle="dropdown"
			aria-expanded="false"> E-LAB Details </a>
		<ul class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
			<li><a class="dropdown-item active" href="AddExercise">Add
					Exercise</a></li>
			<li><a class="dropdown-item" href="exercisedetails">View
					Exercise details</a></li>
			<li><a class="dropdown-item" href="addvm">Add VM</a></li>
			<li><a class="dropdown-item" href="vmdetails">View VM
					details</a></li>
			<li><a class="dropdown-item" href="LabDetails">View E-LAB
					Details</a></li>
			<li>
				<hr class="dropdown-divider">
			</li>
		</ul>
		<a class="nav-link dropdown-toggle text-white" href="#"
			id="navbarDropdown" role="button" data-bs-toggle="dropdown"
			aria-expanded="false"> Assignment </a>
		<ul class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
			<li><a class="dropdown-item" href="AssignBatch">Assign Batch</a></li>
			<li><a class="dropdown-item" href="assignExercise">Assign
					Exercise</a></li>
			<li><a class="dropdown-item" href="Batchexercise">View
					Batchwise Exercise</a></li>
			<li>
				<hr class="dropdown-divider">
			</li>
		</ul>
		<a class="nav-link dropdown-toggle text-white" href="#"
			id="navbarDropdown" role="button" data-bs-toggle="dropdown"
			aria-expanded="false"> Registration Approval </a>
		<ul class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
			<li><a class="dropdown-item" href="StudentApproval">Student
					Approval</a></li>
			<li><a class="dropdown-item" href="TeacherApproval">Teacher
					Approval</a></li>
			<li>
				<hr class="dropdown-divider">
			</li>
		</ul>
		<a class="nav-link dropdown-toggle text-white" href="#"
			id="navbarDropdown" role="button" data-bs-toggle="dropdown"
			aria-expanded="false"> Center Dashboard </a>
		<ul class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
			<li><a class="dropdown-item" href="CenterDetails">Center
					Details</a></li>
			<li><a class="dropdown-item" href="AddCourse">Add Course</a></li>
			<li>
				<hr class="dropdown-divider">
			</li>
		</ul>
		<a class="nav-link dropdown-toggle text-white" href="#"
			id="navbarDropdown" role="button" data-bs-toggle="dropdown"
			aria-expanded="false"> Submissions </a>
		<ul class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
			<li><a class="dropdown-item" href="folders">Advance Lab</a></li>
			<li><a class="dropdown-item" href="basiclab">Basic Lab</a></li>
			<li>
				<hr class="dropdown-divider">
			</li>
		</ul>
		<a href="ExerciseCompletion" style="color: white;"> Reports </a>
		<a class="nav-link dropdown-toggle text-white active" href="#"
			id="navbarDropdown" role="button" data-bs-toggle="dropdown"
			aria-expanded="false"> Exercise Content </a>
		<ul class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
			<li><a class="dropdown-item" href="AddExerciseContent">Add Exercise Content</a></li>
			<li><a class="dropdown-item" href="AddExerciseImage">Add Exercise Image</a></li>
			<li><a class="dropdown-item" href="updateExerciseContent">Update Exercise Content</a></li>
			<li>
				<hr class="dropdown-divider">
			</li>
		</ul>
		<a href="StudentTrackTime" style="color: white; text-decoration: none;">StudentTrackTime</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="deleteAllVmDetails" style="color: white; text-decoration: none;">Delete All VM Details</a>&nbsp;&nbsp;&nbsp;&nbsp;
	</div>
	<div class="card1">
		<div class="card text-center">
			<div class="card-header" style="background-color: white;">
				<h1 style="font-family: Times New Roman;">
					<b>Update Exercise Content</b>
				</h1>
			</div>
			<div id="message">
			    <th:block th:if="${msg}">
			        <p class="text-center fs-3 text-success" th:text="${msg}"></p>
			    </th:block>
			    <th:block th:if="${msg1}">
			        <p class="text-center fs-3 text-danger" th:text="${msg1}"></p>
			    </th:block>
			</div>
			
			<div class="card-body" style="background-color: rgb(205, 214, 224);">
				<div class="form-group">
						<div class="col-md-9 text-center mx-auto">
							<div>
								<label for="exerciseId" class="form-label"><b>Select Exercise</b>
								</label>
								<font color="red">*</font>
								<select class="form-select" name="exerciseIdInput" id="exerciseIdInput" onchange="getExerciseContent(this.value)" required>
									<option value="" disabled selected>Select Exercise</option>
									<option th:each="courseTopic : ${courseTopics}"
										th:value="${courseTopic.Ex_id}"
										th:text="${courseTopic.exer_name}">
									</option>
								</select>
							</div>
							<br>
						<!--	<div>
								<label for="exerciseHeadingNameInput" class="form-label"><b>Exercise Heading Name</b></label>
								<font color="red">*</font> 
								<div class="form-control" type="text" id="exerciseHeadingNameInput" placeholder="Enter exercise name" pattern="[A-Za-z0-9\s]+" name="exerciseHeadingNameInput" autocomplete="off"  contenteditable="true"/>
								<div id="error-message1" style="color: red;"></div>
								
							</div>-->
							<label for="exerciseHeadingNameInput" class="form-label"><b>Exercise Heading Name</b></label>
							<font color="red">*</font>
							<div class="form-control" id="exerciseHeadingNameInput" name="exerciseHeadingNameInput" rows="3" cols="23"  contenteditable="true"></div>
							<div id="error-message" style="color: red;"></div>
							<br>
							<!--<div>
								<label for="titleInput" class="form-label"><b>Title Name</b></label>
								<font color="red">*</font> 
								<div class="form-control" type="text" id="titleInput" placeholder="" pattern="[A-Za-z0-9\s]+" name="titleInput" autocomplete="off"  contenteditable="true"/>
								<div id="error-message1" style="color: red;"></div>
								
							</div>-->
							
							<label for="titleInput" class="form-label"><b>Title Name</b></label>
							<font color="red">*</font>
							<div class="form-control" id="titleInput" name="titleInput" rows="3" cols="23"  contenteditable="true"></div>
							<div id="error-message" style="color: red;"></div>
							
							<br> 
							
							<label for="learningObjectiveInput" class="form-label"><b>Learning Objective</b></label>
							<font color="red">*</font>
							<div class="form-control" id="learningObjectiveInput" name="learningObjectiveInput" rows="3" cols="23"  contenteditable="true"></div>
							<div id="error-message" style="color: red;"></div>
							

							<br>
							
							<label for="descriptionInput" class="form-label"><b>Description</b></label>
							<font color="red">*</font>
							<div class="form-control" id="descriptionInput" placeholder="" name="descriptionInput" rows="3" cols="23"  contenteditable="true"></div>
							<div id="error-message" style="color: red;"></div>
							
							
							<br>
							
							<label for="labInfraStructureInput" class="form-label"><b>About the Exercise lab infrastructure</b></label><font color="red">*</font>
							<div class="form-control" id="labInfraStructureInput"
								placeholder="" name="labInfraStructureInput"
								 rows="3" cols="23"  contenteditable="true"></div>
							<div id="error-message" style="color: red;"></div>
							
							<br>
							
							<label for="attackProcedureInput" class="form-label"><b>Attack Procedure</b></label><font color="red">*</font>
							<div class="form-control" id="attackProcedureInput"
								placeholder="Enter problem statement" name="attackProcedureInput"
								 rows="3" cols="23"  contenteditable="true"></div>
							<div id="error-message" style="color: red;"></div>
							
						</div>
					</div>
					<br>

					<button type="button" id="submitForm" class="btn btn-primary"
						onclick="checkData();" >Save</button>
			
					&nbsp; <a th:href="@{/exercisedetails}"
						class="btn btn-primary mb-2" style="margin-top: 8px;">Back</a>
			</div>
			<form class="needs-validation" novalidate
					th:action="@{/updateExerciseContent}" th:object="${ex}" method="post"
					autocomplete="off" id="moduleform" name="moduleform">

					<input type="hidden" name="hppCode" id="hppCode" /> 
					<input type="hidden" id="exerciseId" name="exerciseId" />
					<input type="hidden" id="exerciseHeadingName" name="exerciseHeadingName" />
					<input type="hidden" id="title" name="title" />
					<input type="hidden" id="learningObjective" name="learningObjective" />
					<input type="hidden" id="description" name="description" />
					<input type="hidden" id="labInfraStructure" name="labInfraStructure" />
					<input type="hidden" id="attackProcedure" name="attackProcedure" />
			</form>
		</div>
	</div>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<div class="class-footer">
		<p
			style="font-family: Times New Roman; text-align: center; color: white; font-size: 18px;">
			<b>Copyright &copy; 2022</b>
		</p>
		<p
			style="font-family: Times New Roman; text-align: center; color: white; font-size: 18px;">
			<b>Designed and Developed by CDAC</b>
		</p>
	</div>
	
	
	
	<script src="/js/sha256.js"></script>
	<script src="/js/crypto-js.js"></script>
	<script src="/js/validation.js"></script>
	<script>
		function checkData() {
		    var exerciseIdInput = document.getElementById("exerciseIdInput").value;
		    var exerciseHeadingNameInput = document.getElementById('exerciseHeadingNameInput').getElementsByClassName('ql-editor')[0].innerHTML;
		    var titleInput = document.getElementById("titleInput").getElementsByClassName('ql-editor')[0].innerHTML;
		    var learningObjectiveInput = document.getElementById("learningObjectiveInput").getElementsByClassName('ql-editor')[0].innerHTML;
		    var descriptionInput = document.getElementById("descriptionInput").getElementsByClassName('ql-editor')[0].innerHTML;
		    var labInfraStructureInput = document.getElementById("labInfraStructureInput").getElementsByClassName('ql-editor')[0].innerHTML;
		    var attackProcedureInput = document.getElementById("attackProcedureInput").getElementsByClassName('ql-editor')[0].innerHTML;
		   
		   	if(exerciseIdInput == "") {
	    		return false;
	    	}
		    // Set values to corresponding hidden input fields
		    document.getElementById("exerciseId").value = exerciseIdInput;
		    document.getElementById("exerciseHeadingName").value = exerciseHeadingNameInput;
		    document.getElementById("title").value = titleInput;
		    document.getElementById("learningObjective").value = learningObjectiveInput;
		    document.getElementById("description").value = descriptionInput;
		    document.getElementById("labInfraStructure").value = labInfraStructureInput;
		    document.getElementById("attackProcedure").value = attackProcedureInput;
		    
		    var inputCode = "";
			inputCode += getInputCode(exerciseIdInput);
			inputCode += getInputCode(exerciseHeadingNameInput);
			inputCode += getInputCode(titleInput);
			inputCode += getInputCode(learningObjectiveInput);
			inputCode += getInputCode(descriptionInput);
			inputCode += getInputCode(labInfraStructureInput);
			inputCode += getInputCode(attackProcedureInput);				
			var hppCode = getHPPCode(origHPPCode, inputCode);
			document.getElementById("hppCode").value = hppCode;
		
		    // Submit the form
		    document.getElementById('moduleform').submit();
		    return false;
		}
	</script>
	
	<script type="text/javascript" th:src="@{/js/jquery-3.7.1.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/quill.js}"></script>
	<script type="text/javascript" th:src="@{/js/select2.full.min.js}"></script>
	<script>
		// Wait for 3 seconds before removing the message
		setTimeout(function() {
			// Get the message element
			var message = document.getElementById("message");
			// Remove the message element from the DOM
			message.parentNode.removeChild(message);
		}, 3000); //
	</script>
	
	<script th:inline="javascript">
	    function getExerciseContent(exerciseId) {
	        fetch('/exerciseContent?exerciseId=' + exerciseId)
	            .then(response => {
	                if (!response.ok) {
	                    throw new Error('Network response was not ok');
	                }
	                return response.json();
	            })
	            .then(data => {
	                console.log('Response data:', data); // Log response data
	                
	                // Clear input fields
	                document.getElementById('exerciseHeadingNameInput').innerHTML = '';
	                document.getElementById('titleInput').innerHTML = '';
	                document.getElementById('learningObjectiveInput').innerHTML = '';
	                document.getElementById('descriptionInput').innerHTML = '';
	                document.getElementById('labInfraStructureInput').innerHTML = '';
	                document.getElementById('attackProcedureInput').innerHTML = '';
	                
	                 /*if(! document.getElementsByClassName('ql-toolbar ql-snow')[0]){
						 element.classList.remove('ql-toolbar', 'ql-snow');
					}*/
					
					// Remove Quill toolbar classes if they exist
	                var editors = document.querySelectorAll('.ql-toolbar.ql-snow');
	                editors.forEach(editor => {
	                  // editor.classList.remove('ql-toolbar', 'ql-snow');
	                  editor.remove();
	                });
	
	                // Update input fields with fetched data if not null
	                if (data) {
	                    document.getElementById('exerciseHeadingNameInput').innerHTML = data.exerciseHeadingName || '';
	                    document.getElementById('titleInput').innerHTML = data.title || '';
	                    document.getElementById('learningObjectiveInput').innerHTML = data.learningObjective || '';
	                    document.getElementById('descriptionInput').innerHTML = data.description || '';
	                    document.getElementById('labInfraStructureInput').innerHTML = data.labInfraStructure || '';
	                    document.getElementById('attackProcedureInput').innerHTML = data.attackProcedure || '';
	                    
	                   
						var quillexerciseHeadingNameInput = new Quill('#exerciseHeadingNameInput', {
						    theme: 'snow' // Specify the theme (snow, bubble, or your custom theme)
						});
						
						var quilltitleInput = new Quill('#titleInput', {
						    theme: 'snow' // Specify the theme (snow, bubble, or your custom theme)
						});
						
					   var quilllearningObjectiveInput = new Quill('#learningObjectiveInput', {
						    theme: 'snow' // Specify the theme (snow, bubble, or your custom theme)
						});
						
						var quillDescriptionInput = new Quill('#descriptionInput', {
						    theme: 'snow' // Specify the theme (snow, bubble, or your custom theme)
						});
						
						var quillLabInfraStructureInput = new Quill('#labInfraStructureInput', {
						    theme: 'snow' // Specify the theme (snow, bubble, or your custom theme)
						});
						
						var quillAttackProcedureInput = new Quill('#attackProcedureInput', {
						    theme: 'snow' // Specify the theme (snow, bubble, or your custom theme)
						});
	                }
	            })
	            .catch(error => console.error('Error fetching exercise content:', error));
	    }
	    
	    $(document).ready(function() {
		    $('#exerciseIdInput').select2({
		    	placeholder:"Select a exercise",
		    	allowClear: true
		    });
		});
	</script>
	

</body>
</html>